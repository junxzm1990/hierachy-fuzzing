WT_DECLARE_WT_MEMBER(1,JavaScriptConstructor,"WSuggestionPopup",(function(e,t,n,i,l,s,o,r,c){t.wtObj=this;const u=this,f=e.WT;let a=null,d=null,g=!1,h=null,p=null,y=s,C=null,m=null,v=!1;this.defaultValue=o;function k(e){return e.classList.contains("Wt-suggest-onedit")||e.classList.contains("Wt-suggest-dropdown")}function T(){return"none"!==t.style.display}function b(i){const l=i.firstChild.firstChild,s=f.getElement(d),o=l.innerHTML,r=l.getAttribute("sug");s.focus();n(s,o,r);e.emit(t,"select",i.id,s.id);w();d=null}let E=null;this.showPopup=function(e){t.style.display="block";u.bringToFront();a=null;m=null;E=e.onkeydown;e.onkeydown=function(e){const t=e||window.event;u.editKeyDown(this,t)}};this.bringToFront=function(){const e=f.maxZIndex();if(e>t.style.zIndex){const n=e+1;t.style.zIndex=n}};function w(){t.style.display="none";if(null!==d&&null!==E){f.getElement(d).onkeydown=E;E=null}}function S(e){if("object"!=typeof f.theme||"bootstrap"!==f.theme.type||5!==f.theme.version)return 16;try{const t=getComputedStyle(e),n=parseInt(t.backgroundSize.match(/^([0-9]+)px ([0-9]+)px$/)[1],10);return n+parseInt(t.backgroundPositionX.match(/^calc[(]100% - ([0-9]+)px[)]$/)[1],10)}catch(e){return 28}}this.editMouseMove=function(e,t){if(!k(e))return;if(f.widgetCoordinates(e,t).x>e.offsetWidth-S(e)){e.classList&&e.classList.add("Wt-suggest-dropdown-hover");e.style.cursor="default"}else{e.classList&&e.classList.remove("Wt-suggest-dropdown-hover");e.style.cursor=""}};this.showAt=function(e,t){w();d=e.id;v=!0;u.refilter(t)};this.editClick=function(e,t){if(!k(e))return;if(f.widgetCoordinates(e,t).x>e.offsetWidth-S(e))if(d===e.id&&T()){w();d=null}else u.showAt(e,"")};function L(e,t){for(e=t?e.nextSibling:e.previousSibling;e;e=t?e.nextSibling:e.previousSibling)if(f.hasTag(e,"LI")&&"none"!==e.style.display)return e;return null}this.editKeyDown=function(n,i){if(!k(n))return!0;if(d!==n.id)if(n.classList.contains("Wt-suggest-onedit")){d=n.id;v=!1}else{if(!n.classList.contains("Wt-suggest-dropdown")||40!==i.keyCode){d=null;return!0}d=n.id;v=!0}if(T()){const l=a?f.getElement(a):null;if(13===i.keyCode||9===i.keyCode){if(l){b(l);f.cancelEvent(i);setTimeout((function(){n.focus()}),0)}else w();return!1}if(40===i.keyCode||38===i.keyCode||34===i.keyCode||33===i.keyCode){if("KEYDOWN"===i.type.toUpperCase()){g=!0;f.cancelEvent(i,f.CancelDefaultAction)}if("KEYPRESS"===i.type.toUpperCase()&&!0===g){f.cancelEvent(i);return!1}let n=l;const s=40===i.keyCode||34===i.keyCode;if(n){const e=34===i.keyCode||33===i.keyCode?t.clientHeight/l.offsetHeight:1;for(let t=0;n&&t<e;++t){const e=L(n,s);if(!e&&c)break;n=e}}else{n=function(e){const n=t.childNodes;for(let t=e?n[0]:n[n.length-1];t;t=e?t.nextSibling:t.previousSibling)if(f.hasTag(t,"LI")&&"none"!==t.style.display)return t;return null}(s);x(n)}if(l){l.className="";a=null}if(n&&f.hasTag(n,"LI")){n.className="active";if("object"==typeof e.theme&&"bootstrap"===e.theme.type&&e.theme.version>=4){l.firstChild.className=l.firstChild.className.replace("active","");n.firstChild.className+=" active"}a=n.id}return!1}}return 13!==i.keyCode&&9!==i.keyCode};this.filtered=function(e,t){h=e;y=t;u.refilter(m)};function x(e){const t=e.parentNode;e.offsetTop+e.offsetHeight>t.scrollTop+t.clientHeight?t.scrollTop=e.offsetTop+e.offsetHeight-t.clientHeight:e.offsetTop<t.scrollTop&&(t.scrollTop=e.offsetTop)}this.refilter=function(n){if(!d)return;let o=a?f.getElement(a):null;const g=f.getElement(d),C=i(g),k=t.childNodes,b=r&&null!==n?n:C(null);m=r?n:g.value;if(l>0||s){if(b.length<l&&!v){w();return}{const n=y?b:b.substring(0,Math.max(null!==h?h.length:0,l));if(n!==h&&n!==p){p=n;e.emit(t,"filter",n)}}}let E=null,S=null;const L=v&&0===b.length;for(let e=0,t=k.length;e<t;++e){const t=k[e];if(f.hasTag(t,"LI")){const n=t.firstChild;null!==t.orig&&void 0!==t.orig||(t.orig=n.firstChild.innerHTML);const i=C(t.orig),l=L||i.match;i.suggestion!==n.firstChild.innerHTML&&(n.firstChild.innerHTML=i.suggestion);if(l){""!==t.style.display&&(t.style.display="");null===E&&(E=t);e===this.defaultValue&&(S=t)}else"none"!==t.style.display&&(t.style.display="none");""!==t.className&&(t.className="")}}if(null===E)w();else{if(!T()){!function(e){t.style.display="block";f.positionAtWidget(t.id,e.id,f.Vertical)}(g);u.showPopup(g);o=null}if((c||S)&&(!o||"none"===o.style.display)){o=S||E;o.parentNode.scrollTop=0;a=o.id}if(o){o.className="active";"object"==typeof f.theme&&"bootstrap"===f.theme.type&&f.theme.version>=4&&(o.firstChild.className+=" active");x(o)}}};this.editKeyUp=function(e,t){if(null!==d&&k(e)&&(T()||13!==t.keyCode&&9!==t.keyCode))if(27===t.keyCode||37===t.keyCode||39===t.keyCode)w();else if(40===t.keyCode||38===t.keyCode||34===t.keyCode||33===t.keyCode);else if(e.value!==m){d=e.id;u.refilter(e.value)}else{const e=a?f.getElement(a):null;e&&x(e)}};t.onclick=function(e){const t=e||window.event;let n=f.target(t);if(!f.hasTag(n,"UL")){for(;n&&!f.hasTag(n,"LI");)n=n.parentNode;n&&b(n)}};t.onscroll=function(){if(C){clearTimeout(C);const e=f.getElement(d);e&&e.focus()}};this.delayHide=function(e,n){C=setTimeout((function(){C=null;!t||null!==e&&d!==e.id||w()}),300)}}));WT_DECLARE_WT_MEMBER(2,JavaScriptConstructor,"WSuggestionPopupStdMatcher",(function(e,t,n,i,l,s,o){function r(e){const t=e.value,l=e.selectionStart?e.selectionStart:t.length;let s=n?t.lastIndexOf(n,l-1)+1:0;for(;s<l&&-1!==i.indexOf(t.charAt(s));)++s;return{start:s,end:l}}this.match=function(n){const i=r(n),o=n.value.substring(i.start,i.end);let c;if(0===s.length)if(0!==l.length){c="(^|(?:[";for(let e=0;e<l.length;++e){let t=l.charCodeAt(e).toString(16);for(;t.length<4;)t="0"+t;c+="\\u"+t}c+="]))"}else c="(^)";else c="("+s+")";c+="("+o.replace(new RegExp("([\\^\\\\\\][\\-.$*+?()|{}])","g"),"\\$1")+")";c=new RegExp(c,"gi");return function(n){if(!n)return o;let i=!1;if(o.length){const l=n.replace(c,"$1"+e+"$2"+t);if(l!==n){i=!0;n=l}}return{match:i,suggestion:n}}};this.replace=function(e,t,n){const i=r(e);let l=e.value.substring(0,i.start)+n+o;i.end<e.value.length&&(l+=e.value.substring(i.end,e.value.length));e.value=l;if(e.selectionStart){e.selectionStart=i.start+n.length+o.length;e.selectionEnd=e.selectionStart}}}));